{% extends 'base.html' %}
{% block content %}

<h2 class="text-2xl font-bold mb-4">Dashboard LÃ­der de Proyectos</h2>
<h2 class="text-2xl font-bold mb-6 text-corporativo-morado">ðŸ“‹ Panel de Proyectos a tu Cargo</h2>

{% set color_map = {
    'activo': 'bg-green-100 text-green-800 border-green-300',
    'suspendido': 'bg-red-100 text-red-800 border-red-300',
    'finalizado': 'bg-blue-100 text-blue-800 border-blue-300',
    'en espera': 'bg-yellow-100 text-yellow-800 border-yellow-300'
} %}

<div class="space-y-10">
    {% for project in projects %}
    <div class="bg-white border border-gray-200 shadow-lg rounded-xl p-6">
        <!-- TÃ­tulo y Estado -->
        <div class="flex flex-col md:flex-row md:justify-between md:items-center mb-4">
            <div>
                <h3 class="text-xl font-bold text-corporativo-morado">{{ project.name }}</h3>
                <p class="text-sm text-gray-600">Inicio: {{ project.start_date }} â€” Fin: {{ project.end_date }}</p>
                <p class="text-sm text-gray-600 mt-1">Progreso: {{ project.progress }}%</p>
                <div class="w-full bg-gray-200 rounded-full h-2 mt-1 mb-2">
                    <div class="bg-corporativo-naranjo h-2 rounded-full transition-all duration-500"
                         style="width: {{ project.progress }}%;"></div>
                </div>
            </div>
            <span class="inline-block px-3 py-1 mt-2 md:mt-0 rounded-full text-xs font-semibold border capitalize {{ color_map[project.status] }}">
                {{ project.status }}
            </span>
        </div>

        {% if project.admin_comment %}
        <div class="mb-4 text-sm text-yellow-800 bg-yellow-50 border-l-4 border-yellow-400 p-3 rounded">
            <strong>Comentario del Administrador:</strong><br>
            {{ project.admin_comment }}
        </div>
        {% endif %}

        <!-- Acciones -->
        <div class="mb-4 flex flex-wrap gap-3">
            <a href="{{ url_for('ver_bitacora', project_id=project.id) }}"
               class="text-xs font-medium text-white bg-corporativo-morado hover:bg-corporativo-naranjo px-3 py-1.5 rounded transition">
                ðŸ“š Ver BitÃ¡cora
            </a>
            <a href="{{ url_for('project_tasks', project_id=project.id) }}"
               class="text-xs font-medium text-white bg-green-600 hover:bg-green-700 px-3 py-1.5 rounded transition">
                âœ… Ver Tareas
            </a>
            <a href="{{ url_for('create_task', project_id=project.id) }}"
               class="text-xs font-medium text-white bg-corporativo-morado hover:bg-corporativo-naranjo px-3 py-1.5 rounded transition">
                âž• Nueva Tarea
            </a>
        </div>

        <!-- Tabla de Tareas -->
        <div class="overflow-x-auto">
            <table class="min-w-[600px] w-full text-sm mt-4 divide-y divide-gray-200 border border-gray-200 rounded">
                <thead class="bg-gray-100 text-left text-xs font-semibold text-gray-700">
                    <tr>
                        <th class="px-4 py-2">Tarea</th>
                        <th class="px-4 py-2">DescripciÃ³n</th>
                        <th class="px-4 py-2">Asignado a</th>
                        <th class="px-4 py-2">Estado</th>
                        <th class="px-4 py-2">Fecha LÃ­mite</th>
                    </tr>
                </thead>
                <tbody class="divide-y divide-gray-100">
                    {% for task in tasks_by_project[project.id] %}
                    <tr>
                        <td class="px-4 py-2 font-medium">{{ task.name }}</td>
                        <td class="px-4 py-2">{{ task.description or 'â€”' }}</td>
                        <td class="px-4 py-2">{{ task.assigned_to.name if task.assigned_to else 'â€”' }}</td>
                        <td class="px-4 py-2 capitalize">{{ task.status }}</td>
                        <td class="px-4 py-2">{{ task.due_date.strftime('%d/%m/%Y') if task.due_date else 'â€”' }}</td>
                    </tr>
                    {% else %}
                    <tr>
                        <td colspan="5" class="text-center px-4 py-4 text-gray-400">No hay tareas para este proyecto</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    {% endfor %}
</div>

{% endblock %}
